<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark" />
  <title>Escape From Nowhere — Single Raid</title>

  <!-- ✅ CSS 분리 -->
  <link rel="stylesheet" href="./css/main.css" />
</head>

<body>
  <div class="bg" aria-hidden="true"></div>
  <div class="grain" aria-hidden="true"></div>
	<!-- ✅ MOBILE STAGE (모바일 전용 UI) -->
<main class="mStage" id="mStage" aria-label="Mobile Game Stage">
  <!-- Top -->
  <header class="mTop">
    <div class="mTopRow">
      <div class="mBrand">
        <b>Escape From Nowhere</b>
        <span class="pill"><span id="ms_apiDot" class="dot"></span><span id="ms_apiStatus">DISCONNECTED</span></span>
      </div>
      <div class="mTopBtns">
        <button class="btn small" id="ms_help" type="button">도움말</button>
        <button class="btn small info" id="ms_sync" type="button" disabled>동기화</button>
      </div>
    </div>

    <div class="mHud">
      <div class="mHudLeft">
        <div class="mName">
          <small>플레이어</small>
          <b id="ms_pName">Survivor</b>
        </div>
        <div class="mHp">
          <div class="mHudLine">
            <span class="hudChip"><strong>HP</strong> <span class="mono"><span id="ms_pHp">80</span>/<span id="ms_pHpMax">80</span></span></span>
            <span class="hudChip"><strong>DEF</strong> <span class="mono" id="ms_pDef">2</span></span>
          </div>
          <div class="bar"><i id="ms_pHpBar"></i></div>
        </div>
      </div>

      <div class="mHudRight">
        <div class="mHudLine">
          <span class="hudChip"><strong>상태</strong> <span id="ms_raidStatus" class="mono">idle</span></span>
          <span class="hudChip"><strong>턴</strong> <span id="ms_turnNo" class="mono">1</span></span>
          <span class="hudChip"><strong>ZONE</strong> <span id="ms_zone" class="mono">R1</span></span>
        </div>
        <div class="mHudLine">
          <span class="hudChip"><strong>탄약</strong> <span class="mono" id="ms_hudAmmo">-</span></span>
          <span class="hudChip"><strong>방어구</strong> <span class="mono" id="ms_hudArmor">-</span></span>
        </div>
      </div>
    </div>
  </header>

  <!-- Center (스크롤 없음) -->
  <section class="mCenter" aria-label="Raid View">
    <div class="mRaidCard">
      <div class="mRaidHead">
        <h2>레이드</h2>
        <button class="btn small info" id="ms_bag" type="button" disabled>가방</button>
      </div>

      <div class="mRaidBody">
        <div class="kv">
          <small>투척 가능(출격반입 + 레이드백)</small>
          <b class="throwLine">
            Stone <span class="mono" id="ms_tStone">0</span>
            <span class="sep">·</span>
            IED <span class="mono" id="ms_tIed">0</span>
            <span class="sep">·</span>
            Grenade <span class="mono" id="ms_tG">0</span>
          </b>
        </div>

        <div class="mHint">
          레이드 중 장비 교체는 <b>RAID BAG(인스턴스)</b>에서만.
        </div>
      </div>
    </div>
  </section>

  <!-- Bottom: Actions -->
  <footer class="mBottom" aria-label="Action Bar">
    <div class="mRow">
      <button id="ms_explore" class="btn ok">탐색</button>
      <button id="ms_rest" class="btn">정비</button>
      <button id="ms_extract" class="btn warn" disabled>탈출</button>
    </div>

    <div class="mRow grid4">
      <button id="ms_attack" class="btn info" disabled>공격</button>
      <button id="ms_throw" class="btn warn" disabled>투척</button>
      <button id="ms_heal" class="btn" disabled>치유</button>
      <button id="ms_run" class="btn bad" disabled>후퇴</button>
    </div>

    <div class="mRow">
      <button id="ms_inv" class="btn info" disabled>인벤</button>
      <button id="ms_log" class="btn">로그</button>
      <button id="ms_help2" class="btn">도움말</button>
    </div>
  </footer>

  <!-- Log Drawer -->
  <section class="mDrawer" id="ms_logDrawer" hidden>
    <div class="mDrawerHead">
      <b>전투 로그</b>
      <div class="mDrawerBtns">
        <button class="btn small" id="ms_logClear" type="button">Clear</button>
        <button class="btn small" id="ms_logClose" type="button">닫기</button>
      </div>
    </div>
    <div class="mDrawerBody" id="ms_logBody" aria-live="polite"></div>
  </section>

  <!-- Inventory Drawer (우선: 기존 인벤 UI를 “복제 표시”) -->
  <section class="mDrawer" id="ms_invDrawer" hidden>
    <div class="mDrawerHead">
      <b>장비 · 인벤</b>
      <div class="mDrawerBtns">
        <button class="btn small" id="ms_invClose" type="button">닫기</button>
      </div>
    </div>
    <div class="mDrawerBody" id="ms_invBody"></div>
  </section>
</main>

  <div class="wrap">
    <div class="container">

      <!-- ===== Topbar ===== -->
      <div class="topbar">
        <div class="brand">
          <b>Escape From Nowhere</b>
          <small>탐색 → 교전/루팅 → 탈출(저장). 레이드 중 스왑은 RAID BAG(인스턴스)에서만.</small>
        </div>
        <div class="top-actions">
          <span class="pill"><span id="apiDot" class="dot"></span><span id="apiStatus">DISCONNECTED</span></span>
          <span class="pill"><span class="dot info"></span><span class="mono">KEY</span> <span id="singleKey">-</span></span>
          <button id="btnHelp" class="btn small">도움말</button>
          <button id="btnInvRefresh" class="btn small info" disabled>동기화</button>
          <button id="btnResetLocal" class="btn small">로컬 리셋</button>
        </div>
      </div>

      <!-- ===== Tarkov-like HUD (Sticky) ===== -->
      <div class="hudTop" aria-label="상단 HUD">
        <div class="hudTopLeft">
          <div class="hudName">
            <small>플레이어</small>
            <b id="pName">Survivor</b>
          </div>

          <div class="hudHP">
            <div class="hudRowLine">
              <span class="hudChip"><strong>HP</strong> <span class="mono"><span id="pHp">80</span>/<span id="pHpMax">80</span></span></span>
              <span class="hudChip"><strong>DEF</strong> <span class="mono" id="pDef">2</span></span>
            </div>
            <div class="bar"><i id="pHpBar"></i></div>
          </div>
        </div>

        <div class="hudTopRight">
          <div class="hudRowLine">
            <span class="hudChip"><strong>상태</strong> <span id="raidStatus" class="mono">idle</span></span>
            <span class="hudChip"><strong>위치</strong> <span id="loc" class="mono">은신처</span></span>
            <span class="hudChip"><strong>턴</strong> <span id="turnNo" class="mono">1</span></span>
            <span class="hudChip"><strong>ZONE</strong> <span id="zone" class="mono">R1</span></span>
          </div>

          <div class="hudRowLine">
            <span class="hudChip"><strong>탄약</strong> <span class="mono" id="hudAmmo">-</span></span>
            <span class="hudChip"><strong>방어구</strong> <span class="mono" id="hudArmor">-</span></span>
          </div>
			<!-- ✅ Mini HUD (Threat / Heartbeat) -->
<div class="miniHud">
  <div class="miniRow">
    <span class="miniLabel">THREAT</span>
    <div class="meter" aria-label="위협도">
      <i id="threatFill"></i>
    </div>
    <span id="threatVal" class="miniVal mono">0%</span>
  </div>

		<div class="miniRow">
			<span class="miniLabel">HEART</span>
			<span id="heartState" class="heart mono">CALM</span>
			<span id="heartBpm" class="miniVal mono">-- bpm</span>
			</div>
		</div>
          <div class="hudTopActions">
            <button id="btnSingleReady" class="btn small ok">싱글 유저 준비</button>
            <button id="btnExtract" class="btn small warn" disabled>탈출</button>
            <input id="singleName" class="select miniInput" placeholder="닉네임(옵션)" />
          </div>
        </div>
      </div>

      <div class="grid">
        <!-- ===== Left: Raid / Combat ===== -->
        <div class="card">
          <div class="hd">
            <h2>레이드</h2>
            <div class="hdRight">
              <button id="btnBagRefresh" class="btn small info" disabled>가방/장비 보기</button>
              <button id="btnGrantStarter" class="btn small" disabled>기본 지급(서버)</button>
            </div>
          </div>

          <div class="bd">
            <div class="combatPanel">

              <div class="kv">
                <small>투척 가능(출격반입 + 레이드백)</small>
                <b class="throwLine">
                  Stone <span class="mono" id="tStone">0</span>
                  <span class="sep">·</span>
                  IED <span class="mono" id="tIed">0</span>
                  <span class="sep">·</span>
                  Grenade <span class="mono" id="tG">0</span>
                </b>
                <div class="combatMiniBtns">
                  <button id="actAttack" class="btn info" disabled>1 공격</button>
                  <button id="actThrow" class="btn warn" disabled>2 투척</button>
                  <button id="actHeal" class="btn" disabled>3 치유</button>
                  <button id="actRun" class="btn bad" disabled>4 후퇴</button>
                </div>
              </div>

              <div class="controls">
                <button id="actExplore" class="btn ok block">N 탐색</button>
                <button id="actRest" class="btn block">정비</button>
                <button class="btn info block" id="openInvDock" type="button">장비·인벤</button>
                <button class="btn block" id="openHelpDock" type="button">도움말</button>
              </div>

              <div class="kv hintBox">
                <small>팁</small>
                <div class="hint">
                  레이드 중 장비 교체는 <b>RAID BAG(인스턴스)</b>에서 카드의 <b>장착</b> 버튼만 누르세요.<br>
                  레이드 중에는 STASH 장착 불가, <b>RAID BAG만 검증/차감</b>.
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- ===== Right: Inventory (Desktop card / Mobile bottom sheet) ===== -->
        <details class="invDock" id="invDock">
          <summary class="invSummary">
            <span class="invSumTitle">장비 · 인벤</span>
            <span class="invSumHint">열기/닫기</span>
          </summary>

          <div class="card invCard">
            <div class="hd">
              <h2>장비 · 인벤</h2>
              <div class="hdRight">
                <span class="pill"><span class="dot"></span><span class="mono">ZONE</span> <span class="mono" id="zone2">R1</span></span>
              </div>
            </div>

            <div class="tabs" role="tablist">
              <button class="tab on" data-tab="tabBag" role="tab">RAID BAG(스왑)</button>
              <button class="tab" data-tab="tabEquip" role="tab">현재 장비</button>
              <button class="tab" data-tab="tabStash" role="tab">STASH</button>
            </div>

            <div class="bd">
              <!-- BAG -->
              <div id="tabBag" class="tabPanel on">
                <div class="hint">
                  <b>레이드 중 스왑(B안)</b>: 레이드백에서 주운 <b>인스턴스 장비(총/근접/방어구)</b>만 즉시 장착 가능.<br>
                  레이드 중에는 STASH 장착 불가, <b>RAID BAG만 검증/차감</b>.
                </div>

                <div class="raidSwapBox">
                  <div class="hint" id="broughtHint">출격 반입 장비(유실 위험): -</div>
                </div>

                <div style="margin-top:10px;">
                  <div class="hint" style="margin-bottom:6px;"><b>인스턴스(총/근접/방어구)</b> — 내구도/장전 표시, 레이드 중 스왑은 여기서</div>
                  <div id="bagInstList" class="instGrid"></div>
                </div>

                <div style="margin-top:14px;">
                  <div class="hint" style="margin-bottom:6px;"><b>스택형(재료/투척/탄약팩)</b></div>
                  <div id="bagList" class="list"></div>
                </div>
              </div>

              <!-- Equip -->
              <div id="tabEquip" class="tabPanel">
                <div class="hint">
                  드롭다운은 “빠른 설정”용. 레이드 중 스왑은 <b>BAG 인스턴스 장착</b>을 권장.
                </div>

                <div class="equipGrid">
                  <div class="equipSlot">
                    <div class="title"><small>주무기</small><b id="eqNowPrimary">-</b></div>
                    <div class="slotRight">
                      <select id="eqPrimary" class="select" aria-label="주무기 선택"></select>
                    </div>
                  </div>
                  <div class="equipSlot">
                    <div class="title"><small>보조무기</small><b id="eqNowSecondary">-</b></div>
                    <div class="slotRight">
                      <select id="eqSecondary" class="select" aria-label="보조무기 선택"></select>
                    </div>
                  </div>
                  <div class="equipSlot">
                    <div class="title"><small>근접</small><b id="eqNowMelee">-</b></div>
                    <div class="slotRight">
                      <select id="eqMelee" class="select" aria-label="근접 무기 선택"></select>
                    </div>
                  </div>
                </div>
              </div>

              <!-- STASH -->
              <div id="tabStash" class="tabPanel">
                <div class="hint">보관함(STASH). 대기(idle) 상태에서만 장착에 사용됩니다.</div>
                <div id="stashList" class="list"></div>
              </div>
            </div>
          </div>
        </details>
      </div>
    </div>
  </div>

  <!-- ===== Docked Combat Log (ALWAYS visible on mobile) ===== -->
  <details class="logDock" id="logDock" open>
    <summary class="logSummary">
      <span class="logSumTitle">전투 로그</span>
      <span class="logSumHint">접기/펼치기</span>
    </summary>
    <div id="log" class="log" aria-live="polite"></div>
  </details>

  <!-- Throw Modal -->
  <div id="throwModalWrap" class="modalWrap" role="dialog" aria-modal="true" aria-label="투척 선택">
    <div class="modal">
      <div class="hd">
        <b>투척 선택</b>
        <button id="btnThrowClose" class="btn small">닫기</button>
      </div>
      <div class="bd" style="display:grid; gap:10px;">
        <div class="throwRow">
          <div><small>돌맹이</small><b>Stone</b></div>
          <div class="right"><span class="qty">x <span id="throwStoneQty">0</span></span><button id="btnThrowStone" class="btn small warn">사용</button></div>
        </div>
        <div class="throwRow">
          <div><small>급조 폭발물(자해 가능)</small><b>IED</b></div>
          <div class="right"><span class="qty">x <span id="throwIedQty">0</span></span><button id="btnThrowIed" class="btn small warn">사용</button></div>
        </div>
        <div class="throwRow">
          <div><small>수류탄</small><b>Grenade</b></div>
          <div class="right"><span class="qty">x <span id="throwGQty">0</span></span><button id="btnThrowG" class="btn small warn">사용</button></div>
        </div>
      </div>
      <div class="ft">
        <button id="btnThrowCancel" class="btn">취소</button>
      </div>
    </div>
  </div>

  <!-- Help / Onboarding Modal -->
  <div id="helpModalWrap" class="modalWrap" role="dialog" aria-modal="true" aria-label="도움말">
    <div class="modal">
      <div class="hd">
        <b>처음 오셨나요?</b>
        <button id="btnHelpClose" class="btn small">닫기</button>
      </div>
      <div class="bd" style="display:grid; gap:10px;">
        <div class="kv" style="margin:0;">
          <small>기본 진행</small>
          <b style="font-size:14px; line-height:1.5;">
            1) <span style="color:var(--ok)">싱글 유저 준비</span> → 2) <span style="color:var(--ok)">탐색</span> → 3) 승리 시 <span style="color:var(--warn)">RAID BAG</span> 루팅 → 4) <span style="color:var(--warn)">탈출</span>하면 STASH 저장
          </b>
        </div>
        <div class="kv" style="margin:0;">
          <small>레이드 중 스왑(B안)</small>
          <b style="font-size:14px; line-height:1.5;">
            레이드 중엔 STASH 장착 불가. <span style="color:var(--warn)">RAID BAG(인스턴스)</span>에서 카드의 <b>장착</b> 버튼으로 교체하세요.
          </b>
          <div class="hint" style="margin-top:8px;">
            총은 탄약이 있어야 발사됩니다. 근접은 내구도가 0이면 파손됩니다.
          </div>
        </div>
        <div class="kv" style="margin:0;">
          <small>조작</small>
          <div class="hint">
            PC: 1공격 / 2투척 / 3치유 / 4후퇴 / N탐색<br>
            모바일: 하단 액션바 버튼만으로 전부 플레이 가능
          </div>
        </div>
      </div>
      <div class="ft">
        <button id="btnHelpDontShow" class="btn">다시 보지 않기</button>
        <button id="btnHelpOk" class="btn ok">확인</button>
      </div>
    </div>
  </div>

  <!-- Bottom action bar -->
  <div class="actionbar" aria-label="모바일 액션바">
    <div class="inner">
      <div class="main">
        <button id="mExplore" class="btn ok">탐색</button>
        <button id="mRest" class="btn">정비</button>
        <button id="mExtract" class="btn warn" disabled>탈출</button>
      </div>
      <div class="combat">
        <button id="mAttack" class="btn info" disabled>공격</button>
        <button id="mThrow" class="btn warn" disabled>투척</button>
        <button id="mHeal" class="btn" disabled>치유</button>
        <button id="mRun" class="btn bad" disabled>후퇴</button>
      </div>
      <div class="main">
        <button id="mBag" class="btn info" disabled>가방</button>
        <button id="mSync" class="btn info" disabled>동기화</button>
        <button id="mHelp" class="btn">도움말</button>
      </div>
    </div>
  </div>
<!-- ✅ Hit Direction FX Overlay -->
<div id="hitFx" class="hitFx" aria-hidden="true">
  <i class="hitDir up" data-dir="up"></i>
  <i class="hitDir right" data-dir="right"></i>
  <i class="hitDir down" data-dir="down"></i>
  <i class="hitDir left" data-dir="left"></i>
  <div class="hitRing"></div>
</div>

<!-- ✅ Screen vignette pulse (low HP) -->
<div id="vignette" class="vignette" aria-hidden="true"></div>	
  <!-- ✅ JS 분리 -->
  <script src="./js/state.js" defer></script>
  <script src="./js/api.js" defer></script>
  <script src="./js/ui.js" defer></script>
  <script src="./js/game.js" defer></script>
  <script src="./js/app.js" defer></script>
  <script src="./js/hud_fx.js" defer></script>

  <!-- (옵션) HTML만으로 invDock 열기 보조: JS 없이도 동작하지만, 버튼 클릭 시 열리게 하고 싶으면 app.js에서 처리 가능 -->
  <script>
    // 최소 보조: 버튼으로 details 열기 (기존 app.js 건드리기 싫으면 그대로 둬도 됨)
    document.addEventListener("DOMContentLoaded", () => {
      const inv = document.getElementById("invDock");
      const openInv = document.getElementById("openInvDock");
      if (inv && openInv) openInv.addEventListener("click", () => inv.open = true);

      const helpBtn = document.getElementById("openHelpDock");
      if (helpBtn) helpBtn.addEventListener("click", () => document.getElementById("btnHelp")?.click());
    });
  </script>
</body>
</html>
